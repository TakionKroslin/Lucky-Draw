<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âà´Á¥ßÂº†</title>
    <link rel="icon" href="https://pic1.imgdb.cn/item/693d67f925ec9c13612be403.jpg" type="image/jpeg">
    
    <style>
        /* --- ÂÖ®Â±ÄÊ†∑Âºè --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            color: #000000;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Helvetica, Arial, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between; 
            overflow: hidden;
            perspective: 1000px;
        }

        .main-content {
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            position: relative;
        }

        /* --- ËøáÊª§Âô®Ê†∑Âºè --- */
        .filter-container {
            position: relative;
            z-index: 1000;
            margin-bottom: 20px;
            display: flex; 
        }

        #btn-filter {
            background-color: #fff;
            color: #000;
            border: 1px solid #e0e0e0;
            padding: 10px 24px;
            min-width: 120px;
            font-size: 15px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        #btn-filter:hover {
            background-color: #f9f9f9;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        #btn-filter.active {
            background-color: #000;
            color: #fff;
            border-color: #000;
        }

        .filter-menu {
            position: absolute;
            top: calc(100% + 10px); 
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background-color: #fff;
            border: none;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            padding: 6px;
            min-width: 140px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .filter-menu.open {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .filter-option {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            border-radius: 10px;
            text-align: center;
            transition: background-color 0.2s;
            margin-bottom: 2px;
        }

        .filter-option:last-child { margin-bottom: 0; }
        .filter-option:hover { background-color: #f5f5f5; }

        .filter-option.base-option.selected {
            background-color: #000;
            color: #fff;
            font-weight: 600;
        }
        
        .filter-option.bonus-option { color: #333; font-weight: normal; }
        .filter-option.bonus-option:hover { background-color: #f5f5f5; }
        
        .filter-option.bonus-skill.selected {
            background-color: #ff9800; 
            color: #fff;
            font-weight: 600;
        }

        .filter-option.bonus-teacher.selected {
            background-color: #2196f3; 
            color: #fff;
            font-weight: 600;
        }

        .filter-separator {
            height: 1px;
            background-color: #eee;
            margin: 6px 0;
        }

        /* --- Â§¥ÂÉèÂå∫Âüü --- */
        .top-section {
            height: 220px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .avatar-container {
            width: 200px;
            height: 200px;
            border-radius: 40px;
            overflow: hidden;
            border: 4px solid #000;
            opacity: 0; 
            transform: scale(0.8);
            /* **‰øÆÊîπÁÇπ 1:** Â¢ûÂä† background-color: #fff; Èò≤Ê≠¢Èó™ÁôΩ */
            transition: opacity 0.3s ease, transform 0.3s ease; 
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            position: relative; 
            background-color: #fff; 
        }
        
        .avatar-container.show {
            opacity: 1;
            transform: scale(1);
        }

        .avatar-container:hover:not(.no-hover-effect) {
            transform: rotate(15deg) scale(1.1);
            transition: transform 0.4s ease-in-out;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        
        .avatar-container.hide-img .avatar-img {
            display: none;
        }

        /* --- ÊäÄËÉΩ/ËÄÅÂ∏àÊñáÂ≠ó‰ºòÂåñ --- */
        .non-person-name {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Â±Ö‰∏≠Ê†∏ÂøÉ‰ª£Á†Å */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center; 
            
            font-size: 32px; 
            font-weight: 800;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            line-height: 1.3;
            padding: 20px; 
            box-sizing: border-box; 
            word-break: break-word; 
        }
        
        .skill-item .non-person-name { background-color: #ff9800; }
        .teacher-item .non-person-name { background-color: #2196f3; }
        
        /* --- Âä®ÁîªÁâπÊïà --- */
        
        /* 1. ÊôÆÈÄöÁøªËΩ¨Âä®Áîª */
        .avatar-container.card-animate {
            transition: none;
            opacity: 1 !important;
            animation: card-flip 1.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        @keyframes card-flip {
            0% { transform: scale(0.5) rotateY(0deg) rotateZ(-10deg); opacity: 0; }
            40% { transform: scale(1.1) rotateY(360deg) rotateZ(5deg); opacity: 1; }
            70% { transform: scale(1.05) rotateY(720deg) rotateZ(-2deg); }
            100% { transform: scale(1) rotateY(720deg) rotateZ(0deg); opacity: 1; }
        }
        
        /* 2. ËÄÅÂ∏à/ÊäÄËÉΩ ÁÇ´ÈÖ∑ÁàÜÁÇ∏Âä®Áîª */
        .special-draw-effect {
            transition: none;
            opacity: 1 !important;
            animation: super-explosion 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes super-explosion {
            0% { 
                transform: scale(0) rotate(0deg); 
                opacity: 0;
                box-shadow: 0 0 0 rgba(255, 215, 0, 0);
            }
            40% { 
                transform: scale(1.2) rotate(-5deg); 
                opacity: 1;
                box-shadow: 0 0 50px rgba(255, 215, 0, 0.8), 0 0 100px rgba(255, 140, 0, 0.6);
            }
            60% {
                transform: scale(1.1) rotate(5deg);
                box-shadow: 0 0 80px rgba(255, 215, 0, 1), 0 0 150px rgba(255, 69, 0, 0.8);
            }
            80% {
                transform: scale(1.05) rotate(-2deg);
            }
            100% { 
                transform: scale(1) rotate(0deg); 
                opacity: 1;
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.6); 
            }
        }

        /* --- ÂÖâÊïà --- */
        .glow-rare {
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.6), 0 0 40px rgba(0, 191, 255, 0.3);
            border-color: rgba(0, 191, 255, 0.8) !important;
        }
        .glow-epic {
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.6), 0 0 40px rgba(138, 43, 226, 0.3);
            border-color: rgba(138, 43, 226, 0.8) !important;
        }
        .glow-legend {
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.5);
            border-color: rgba(255, 215, 0, 0.9) !important;
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* --- ‰∏≠Èó¥ÔºöÂêçÂ≠óÊòæÁ§∫ --- */
        .middle-section {
            margin-bottom: 40px;
            text-align: center;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #name-display {
            font-size: 48px;
            font-weight: 800;
            letter-spacing: 1px;
            padding: 10px 40px;
            border-radius: 24px;
            background-color: #f7f7f7;
            border: 2px solid #f0f0f0;
            min-width: 320px;
            overflow: hidden;
            position: relative;
            color: #1a1a1a;
        }

        @keyframes slideOutUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100%); opacity: 0; }
        }
        @keyframes slideInUp {
            0% { transform: translateY(100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .slide-out-up { animation: slideOutUp 0.2s ease-in forwards; }
        .slide-in-up { animation: slideInUp 0.3s ease-out forwards; }

        /* --- Â∫ïÈÉ®ÊåâÈíÆÂå∫Âüü --- */
        .bottom-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        button.action-btn {
            background-color: #000;
            color: #fff;
            border: none;
            padding: 16px 48px; 
            font-size: 18px;
            font-weight: 700;
            border-radius: 100px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            outline: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        button.action-btn:hover {
            background-color: #333;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        button.action-btn:active { transform: translateY(0); }
        button.action-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ÊòæÁ§∫ÂéüÂêçÊåâÈíÆ */
        #btn-reveal {
            background-color: #fff;
            color: #000;
            border: 2px solid #000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(15px);
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            padding: 14px 40px;
            border-radius: 100px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        #btn-reveal:hover { background-color: #f7f7f7; }
        .reveal-show {
            opacity: 1 !important;
            visibility: visible !important;
            transform: translateY(0) !important;
        }
        .reveal-hidden {
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none;
        }
        
        /* --- Footer --- */
        .footer {
            width: 100%;
            padding: 12px 0;
            background-color: #fafafa;
            border-top: none;
            text-align: center;
            font-size: 13px;
            color: #888;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }
        .footer-separator { color: #ddd; font-size: 14px; }
        .footer-github a {
            color: #888;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            transition: color 0.3s;
        }
        .footer-github a:hover { color: #000; }
        .github-icon { width: 18px; height: 18px; fill: currentColor; display: block; }

    </style>
</head>
<body>

    <div class="main-content">
        <div class="filter-container">
            <div id="btn-filter" title="ÁÇπÂáªÈÄâÊã©ÊäΩÂèñËåÉÂõ¥">
                <span id="filter-text">ÊâÄÊúâ‰∫∫</span>
                <span style="font-size: 10px; opacity: 0.5;">‚ñº</span>
            </div>
            <div class="filter-menu" id="filter-menu">
                <div class="filter-option base-option selected" data-type="group" data-value="ÊâÄÊúâ‰∫∫">ÊâÄÊúâ‰∫∫</div>
                <div class="filter-option base-option" data-type="group" data-value="ÁîüÁâ©">ÁîüÁâ©</div>
                <div class="filter-option base-option" data-type="group" data-value="ÊîøÊ≤ª">ÊîøÊ≤ª</div>
                
                <div class="filter-separator"></div>
                
                <div class="filter-option bonus-option bonus-skill" data-type="bonus" data-value="ÊäÄËÉΩ">ÊäÄËÉΩ</div>
                <div class="filter-option bonus-option bonus-teacher" data-type="bonus" data-value="ËÄÅÂ∏à">ËÄÅÂ∏à</div>
            </div>
        </div>
        
        <div class="top-section">
            <div class="avatar-container" id="avatar-box">
                <div class="non-person-name" id="non-person-name-display" style="display: none;"></div>
                <img src="" alt="Avatar" class="avatar-img" id="avatar-img">
            </div>
        </div>

        <div class="middle-section">
            <div id="name-display">Âà´Á¥ßÂº†</div> 
        </div>

        <div class="bottom-section">
            <button id="btn-main" class="action-btn">ÂºÄÂßãÊªöÂä®</button>
            <button id="btn-reveal">ÊòæÁ§∫ÂéüÂêç</button>
        </div>
    </div>
    
    <div class="footer">
        <span>Copyright ¬© Tachibana Kousuke 2025</span>
        <span class="footer-separator">|</span>
        <span class="footer-github">
            <a href="https://github.com/TachibanaKousuke/Lucky-Draw" target="_blank" title="ËÆøÈóÆ GitHub ‰ªìÂ∫ì">
                <svg class="github-icon" viewBox="0 0 16 16" version="1.1" aria-hidden="true">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2h.02c0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
        </span>
    </div>

    <script>
        // --- 1. Êï∞ÊçÆÈÖçÁΩÆÂå∫Âüü ---
        const database = [
            { nickname: "ÈùíË°åÂΩí", realname: "ËâæÁÇúÊù∞", avatarUrl: "https://pic1.imgdb.cn/item/6932846ad1e741a32bf1b9da.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "Tiamo", realname: "ËâæÊñáÂçö", avatarUrl: "https://pic1.imgdb.cn/item/6932846ad1e741a32bf1b9dc.jpg", subject: "ÁîüÁâ©" },
            { nickname: "blue IHrNm", realname: "ÊõπÁëæÁëú", avatarUrl: "https://pic1.imgdb.cn/item/6932846ad1e741a32bf1b9db.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "Èô≥È£é", realname: "ÈôàÊûóÈúÑ", avatarUrl: "https://pic1.imgdb.cn/item/6932846ad1e741a32bf1b9dd.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Áî∞Áî∞Â∞èÂΩ±Â≠ê", realname: "ÈôàËççÂΩ±", avatarUrl: "https://pic1.imgdb.cn/item/6932846ad1e741a32bf1b9d9.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "CzX", realname: "ÈôàÂú®ËäØ", avatarUrl: "https://pic1.imgdb.cn/item/69328473d1e741a32bf1b9eb.jpg", subject: "ÁîüÁâ©" },
            { nickname: "ü§ê", realname: "Á®ãÊÅ©Ê≥Ω", avatarUrl: "https://pic1.imgdb.cn/item/69328473d1e741a32bf1b9ec.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Il sole.", realname: "ÈÇìÊ∑º", avatarUrl: "https://pic1.imgdb.cn/item/69328473d1e741a32bf1b9ed.jpg", subject: "ÁîüÁâ©" },
            { nickname: "pit pony", realname: "ÈÇìËêßÊôì", avatarUrl: "https://pic1.imgdb.cn/item/69328473d1e741a32bf1b9ee.jpg", subject: "ÁîüÁâ©" },
            { nickname: "ÁôΩÁãóÈªë", realname: "ÂÜØÈ∫íÈúè", avatarUrl: "https://pic1.imgdb.cn/item/69328435d1e741a32bf1b991.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "È´òÂÜ∑‰∫∫Â£´Ê≤°ÊúâÂæÆ‰ø°", realname: "È´òÊ∂µ‰∫à", avatarUrl: "https://api.dicebear.com/7.x/identicon/svg?seed=Felix", subject: "ÁîüÁâ©" },
            { nickname: "Ê≥±Ê≥±Ê∏ÖÊΩ≠", realname: "È´ò‰∏ÄÊ∑≥", avatarUrl: "https://pic1.imgdb.cn/item/69328477d1e741a32bf1b9f6.jpg", subject: "ÁîüÁâ©" },
            { nickname: "ËêùÂçú‰∏ùÊØîÂ∞î", realname: "ËæúÂ≠ôÈõ®Ëæ∞", avatarUrl: "https://pic1.imgdb.cn/item/69328477d1e741a32bf1b9f9.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "Ê¨ßÁöáÁü•Â∫ï", realname: "‰Ωï‰∫¶Âòâ", avatarUrl: "https://pic1.imgdb.cn/item/69328436d1e741a32bf1b993.jpg", subject: "ÁîüÁâ©" },
            { nickname: "ÂçÉ", realname: "Èü©Èì≠Êù∞", avatarUrl: "https://pic1.imgdb.cn/item/69328477d1e741a32bf1b9f7.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Ê≠•Ê≥ïÈπÖ", realname: "Ë°°ÊòüÁéô", avatarUrl: "https://pic1.imgdb.cn/item/69328477d1e741a32bf1b9f5.jpg", subject: "ÁîüÁâ©" },
            { nickname: "ÊÉÖÂïÜÂ∑ÖÂ≥∞Êó∂Êúü", realname: "ËÉ°Èì∏", avatarUrl: "https://pic1.imgdb.cn/item/6932847ed1e741a32bf1ba05.jpg", subject: "ÁîüÁâ©" },
            { nickname: "ÈªÑÂ∞èÂ¶π", realname: "ÈªÑÂΩ¶Ê¥Å", avatarUrl: "https://pic1.imgdb.cn/item/6932847ed1e741a32bf1ba02.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Êó†ÊÅô.", realname: "ÊùéÂÆâÁÑ∂", avatarUrl: "https://pic1.imgdb.cn/item/6932847ed1e741a32bf1ba01.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Touma Kazusa", realname: "ÊùéÊüØÈî¶", avatarUrl: "https://pic1.imgdb.cn/item/6932847ed1e741a32bf1ba03.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Camilla", realname: "ÊùéÊûóËîö", avatarUrl: "https://pic1.imgdb.cn/item/6932847ed1e741a32bf1ba04.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Eschatology", realname: "ÂªñÂÆ∂Âòâ", avatarUrl: "https://pic1.imgdb.cn/item/69328489d1e741a32bf1ba10.jpg", subject: "ÁîüÁâ©" },
            { nickname: "ÊúâÊÇ†", realname: "ÂªñËΩ©Êµ©", avatarUrl: "https://pic1.imgdb.cn/item/69328489d1e741a32bf1ba12.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "ÂàòËΩ©", realname: "ÂàòËΩ©", avatarUrl: "https://pic1.imgdb.cn/item/69328435d1e741a32bf1b98d.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "ËΩ©üèÉüèÄ", realname: "ÂêïÂ≠êËΩ©", avatarUrl: "https://pic1.imgdb.cn/item/69328435d1e741a32bf1b992.jpg", subject: "ÁîüÁâ©" },
            { nickname: "ÊèΩÊòüÊ≤≥", realname: "È©¨ÊòüÁÅø", avatarUrl: "https://pic1.imgdb.cn/item/69328489d1e741a32bf1ba11.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Â∞èÂ§©ÊâçÊùèÂÆù", realname: "ÂΩ≠Ê∏ù‰∏≠", avatarUrl: "https://pic1.imgdb.cn/item/6932848fd1e741a32bf1ba1a.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "ÊàëÂèà‰∏çÊòØËã¶Âäõ", realname: "ÂîêËè±Ëîö", avatarUrl: "https://pic1.imgdb.cn/item/693286fdd1e741a32bf1bd63.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Â∞èÁéãÂú®Ê≠§Âàª", realname: "ÁéãÁà±Èò≥", avatarUrl: "https://pic1.imgdb.cn/item/6932848fd1e741a32bf1ba1b.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "Ê∂µ", realname: "Áéã‰πôÊ∂µ", avatarUrl: "https://pic1.imgdb.cn/item/6932848fd1e741a32bf1ba19.jpg", subject: "ÁîüÁâ©" },
            { nickname: "‰∏ÄÂåóÊûÅÂÖâ", realname: "ÁéãÊáø", avatarUrl: "https://pic1.imgdb.cn/item/6932848fd1e741a32bf1ba1c.jpg", subject: "ÁîüÁâ©" },
            { nickname: "q7l12", realname: "ÁéãÈ¢ñËê±", avatarUrl: "https://pic1.imgdb.cn/item/6932848fd1e741a32bf1ba1d.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Hello", realname: "ÁéãËµûÊù∞", avatarUrl: "https://pic1.imgdb.cn/item/69328494d1e741a32bf1ba23.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Tachibana Kousuke", realname: "Èü¶ÊôØÁöì", avatarUrl: "https://pic1.imgdb.cn/item/69328494d1e741a32bf1ba21.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Anonymous", realname: "È≠èÁÜôËäÆ", avatarUrl: "https://pic1.imgdb.cn/item/69328494d1e741a32bf1ba25.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Êñá‰∏â", realname: "ÊñáÊÄùÁùø", avatarUrl: "https://pic1.imgdb.cn/item/69328494d1e741a32bf1ba22.jpg", subject: "ÁîüÁâ©" },
            { nickname: "WCSDM", realname: "Âê¥ÂêëÁéâ", avatarUrl: "https://pic1.imgdb.cn/item/69328435d1e741a32bf1b98f.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Ë•øÁìúÂà®ÂÜ∞", realname: "È≤úÂçìÂΩ§", avatarUrl: "https://pic1.imgdb.cn/item/69328499d1e741a32bf1ba29.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "ÊÉüÊ•öÊúâÊâç", realname: "ÂæêÊ•öÁÉ¶", avatarUrl: "https://pic1.imgdb.cn/item/69328499d1e741a32bf1ba2b.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Áª≠ÂèôÂ∫è", realname: "ÂæêÂ≠êÊÅí", avatarUrl: "https://pic1.imgdb.cn/item/69328499d1e741a32bf1ba2c.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "ÊóãËΩ¨‚ÑÉÁöÑÊó∂ÂÖâ", realname: "Êù®ÊàêÂÆá", avatarUrl: "https://pic1.imgdb.cn/item/69328499d1e741a32bf1ba2a.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Nernst", realname: "Êù®Ëã•Èõ∑", avatarUrl: "https://pic1.imgdb.cn/item/69328499d1e741a32bf1ba2d.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Èº†‰∫Ü", realname: "Êù®ÂÆ£Êµ©", avatarUrl: "https://pic1.imgdb.cn/item/6932849cd1e741a32bf1ba31.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "ÈõèÈ∏£", realname: "Êù®Êáø", avatarUrl: "https://pic1.imgdb.cn/item/6932849cd1e741a32bf1ba34.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Ray", realname: "Âº†Ê∑ôÁùø", avatarUrl: "https://pic1.imgdb.cn/item/6932849cd1e741a32bf1ba32.jpg", subject: "ÁîüÁâ©" },
            { nickname: "‰∏ùË°ÄÂèçËôæÈó∞ÂúüÁöÑÁåπ", realname: "Âº†Ê¢ìËΩ©", avatarUrl: "https://pic1.imgdb.cn/item/6932849cd1e741a32bf1ba35.jpg", subject: "ÁîüÁâ©" },
            { nickname: "AQ", realname: "ËµµÊΩú", avatarUrl: "https://pic1.imgdb.cn/item/6932849cd1e741a32bf1ba33.jpg", subject: "ÊîøÊ≤ª" },
            { nickname: "(ÔºûÔºú)", realname: "ËµµÁßãÁéâ", avatarUrl: "https://pic1.imgdb.cn/item/693284a1d1e741a32bf1ba3a.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Zfang", realname: "ÈÉëÊîæ", avatarUrl: "https://pic1.imgdb.cn/item/693284a1d1e741a32bf1ba3c.jpg", subject: "ÁîüÁâ©" },
            { nickname: "Emmanuel", realname: "Âë®ÊüØËøê", avatarUrl: "https://pic1.imgdb.cn/item/69328435d1e741a32bf1b98e.jpg", subject: "ÁîüÁâ©" },
            { nickname: "y", realname: "ÈÇπÂ§©Êù∞", avatarUrl: "https://pic1.imgdb.cn/item/693284a1d1e741a32bf1ba3b.jpg", subject: "ÁîüÁâ©" },
            { nickname: "LZZN", realname: "ÂàòÁü•Êòì", avatarUrl: "https://pic1.imgdb.cn/item/693d6d7ffe7cfeca3822ee6f.jpg", subject: "ÁîüÁâ©" },
        ];
        
        const SKILLS = [
            { type: "skill", nickname: "‰∏áÁÆ≠ÈΩêÂèë", realname: "‰∏áÁÆ≠ÈΩêÂèë", avatarUrl: "", isSpecial: true, rarity: 'legend', className: 'skill-item' },
            { type: "skill", nickname: "ÈìÅÁ¥¢ËøûÁéØ", realname: "ÈìÅÁ¥¢ËøûÁéØ", avatarUrl: "", isSpecial: true, rarity: 'epic', className: 'skill-item' },
            { type: "skill", nickname: "ÂÄüÂàÄÊùÄ‰∫∫", realname: "ÂÄüÂàÄÊùÄ‰∫∫", avatarUrl: "", isSpecial: true, rarity: 'epic', className: 'skill-item' },
            { type: "skill", nickname: "Ê°ÉÂõ≠Áªì‰πâ", realname: "Ê°ÉÂõ≠Áªì‰πâ", avatarUrl: "", isSpecial: true, rarity: 'rare', className: 'skill-item' },
            { type: "skill", nickname: "ÁÅ´ÁàÜËæ£Ê§í", realname: "ÁÅ´ÁàÜËæ£Ê§í", avatarUrl: "", isSpecial: true, rarity: 'rare', className: 'skill-item' },
            { type: "skill", nickname: "‰∏ã‰∏™ÂèåÂÄç", realname: "‰∏ã‰∏™ÂèåÂÄç", avatarUrl: "", isSpecial: true, rarity: 'legend', className: 'skill-item' },
        ];
        
        const TEACHERS = [
            { type: "teacher", nickname: "ÈáëÊµ™", realname: "ÈáëÊµ™", avatarUrl: "", isSpecial: true, rarity: 'legend', className: 'teacher-item' },
            { type: "teacher", nickname: "ÂàòÂ∑ù", realname: "ÂàòÂ∑ù", avatarUrl: "", isSpecial: true, rarity: 'epic', className: 'teacher-item' },
            { type: "teacher", nickname: "ÂàòË∂Ö", realname: "ÂàòË∂Ö", avatarUrl: "", isSpecial: true, rarity: 'epic', className: 'teacher-item' },
            { type: "teacher", nickname: "ÁéãÁõº", realname: "ÁéãÁõº", avatarUrl: "", isSpecial: true, rarity: 'rare', className: 'teacher-item' },
            { type: "teacher", nickname: "Ë¶ÉÂã§", realname: "Ë¶ÉÂã§", avatarUrl: "", isSpecial: true, rarity: 'rare', className: 'teacher-item' },
            { type: "teacher", nickname: "Èü¶Âª∫ÂÜõ", realname: "Èü¶Âª∫ÂÜõ", avatarUrl: "", isSpecial: true, rarity: 'rare', className: 'teacher-item' },
            { type: "teacher", nickname: "Áéã‰øä‰∏ú", realname: "Áéã‰øä‰∏ú", avatarUrl: "", isSpecial: true, rarity: 'rare', className: 'teacher-item' },
        ];

        const startPhrases = [
            "ËÆ©ÊàëÁúãÁúãË∞ÅÂú®Á¥ßÂº†", "ÊòØË∞ÅÁöÑÂ∞èÈπøÂú®‰π±Êíû", "Ê∑±ÂëºÂê∏ÔºåÂ§¥ÊôïÊòØÊ≠£Â∏∏ÁöÑ",
            "Âà´Ë∫≤‰∫ÜÔºåÊàëÈÉΩÁúãÂà∞‰Ω†‰∫Ü", "Ê≠§Êó∂‰∏ÄÂêçÂπ∏ËøêËßÇ‰ºóÊ±óÊµÅÊµÉËÉå", "ÂëΩËøêÁöÑÈΩøËΩÆÂºÄÂßãËΩ¨Âä®",
            "Âè™ÊòØÊäΩ‰∏™Êü•ÔºåÂà´ÊÖå", "ÁúºÁ•ûÂà´È£òÔºåÁúãÁùÄÊàë", "ÂáÜÂ§áÂ•Ω‰Ω†ÁöÑË°®Êºî‰∫ÜÂêó", "ËÆ©ÊàëÂ∫∑Â∫∑ÊòØË∞ÅËøô‰πàÂπ∏Ëøê"
        ];
        
        const glowClasses = ['glow-rare', 'glow-epic', 'glow-legend'];

        // --- 2. ÂèòÈáèÂÆö‰πâ ---
        const nameDisplay = document.getElementById('name-display');
        const btnMain = document.getElementById('btn-main');
        const btnReveal = document.getElementById('btn-reveal');
        const avatarBox = document.getElementById('avatar-box');
        const avatarImg = document.getElementById('avatar-img');
        const nonPersonNameDisplay = document.getElementById('non-person-name-display');
        const btnFilter = document.getElementById('btn-filter');
        const filterText = document.getElementById('filter-text');
        const filterMenu = document.getElementById('filter-menu');
        
        const baseOptions = document.querySelectorAll('.filter-option.base-option');
        const bonusOptions = document.querySelectorAll('.filter-option.bonus-option');

        let isRolling = false;
        let timer = null;
        let selectedUser = null; 
        let isRealNameShowing = false; 
        
        let currentGroup = 'ÊâÄÊúâ‰∫∫'; 
        let activeBonuses = [];   

        let filteredDatabase = []; 
        let shuffleIndex = 0; 
        let shuffledList = []; 
        
        let nextSelectedUser = null;

        // --- 3. Ê†∏ÂøÉÂäüËÉΩÂáΩÊï∞ ---

        function filterAndShuffleDatabase() {
            let studentList;
            if (currentGroup === 'ÊâÄÊúâ‰∫∫') {
                studentList = [...database];
            } else {
                studentList = database.filter(user => user.subject === currentGroup);
            }

            let specialItems = [];
            if (activeBonuses.includes('ÊäÄËÉΩ')) {
                specialItems = specialItems.concat(SKILLS);
            }
            if (activeBonuses.includes('ËÄÅÂ∏à')) {
                specialItems = specialItems.concat(TEACHERS);
            }
            
            if (studentList.length === 0 && specialItems.length > 0) {
                 filteredDatabase = specialItems;
            } else if (studentList.length > 0) {
                filteredDatabase = studentList.concat(specialItems);
            } else {
                filteredDatabase = [];
            }
            
            if (filteredDatabase.length === 0) {
                nameDisplay.innerText = `Êó†Êï∞ÊçÆ (${currentGroup})`;
                btnMain.disabled = true;
                return false;
            }
            
            btnMain.disabled = false;
            
            shuffledList = [...filteredDatabase]; 
            for (let i = shuffledList.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1)); 
                [shuffledList[i], shuffledList[j]] = [shuffledList[j], shuffledList[i]];
            }
            
            shuffleIndex = 0;
            return true;
        }

        // Ëé∑Âèñ‰∏ã‰∏Ä‰∏™ÁªìÊûúÔºàÈÄªËæëÔºâ
        function getNextShuffledItem() {
            if (shuffleIndex >= shuffledList.length) {
                if (!filterAndShuffleDatabase()) {
                    return null;
                }
                console.log("ÂàóË°®Â∑≤ÊäΩÂÆåÔºåÈáçÊñ∞Ê¥óÁâå„ÄÇ");
            }
            const item = shuffledList[shuffleIndex];
            shuffleIndex++; 
            return item;
        }
        
        // ÂáÜÂ§á‰∏ã‰∏ÄÊ¨°ÊäΩÂèñÁªìÊûúÂπ∂È¢ÑÂä†ËΩΩ
        function prepareNextDraw() {
            nextSelectedUser = getNextShuffledItem();
            // Â¶ÇÊûúÊòØÂ≠¶ÁîüÔºåÊèêÂâçÂä†ËΩΩÂõæÁâá
            if (nextSelectedUser && !nextSelectedUser.isSpecial && nextSelectedUser.avatarUrl) {
                const img = new Image();
                img.src = nextSelectedUser.avatarUrl;
                // Á°Æ‰øùÂõæÁâáÂä†ËΩΩÊàêÂäüÔºåÊàñËÄÖËá≥Â∞ëÂ∞ùËØïÂä†ËΩΩ
                img.onload = () => console.log("Â∑≤È¢ÑÂä†ËΩΩÂõæÁâá:", nextSelectedUser.nickname);
                img.onerror = () => console.log("È¢ÑÂä†ËΩΩÂõæÁâáÂ§±Ë¥•:", nextSelectedUser.nickname);
            }
        }
        
        // **‰øÆÊîπÁÇπ 2 & 3: ‰ºòÂåñÂä®ÁîªÊ∏ÖÈô§ÂíåÁ¶ÅÁî®Êó∂Èó¥**
        function startRolling() {
            if (isRolling) return; 
            
            // Â¶ÇÊûú‰∏äÊ¨°ÊäΩÂèñÁöÑÊòØËÄÅÂ∏à/ÊäÄËÉΩÔºåÈúÄË¶ÅÊâßË°åÊ∂àÂ§±Âä®ÁîªÔºåÂπ≥ÊªëËøáÊ∏°
            if (selectedUser && selectedUser.isSpecial) {
                // Ê∏ÖÈô§ÁâπÊÆäÂä®ÁîªÁ±ªÔºåËÆ©ÂÆÉÈÄöËøá opacity transition Ê∂àÂ§±
                avatarBox.classList.remove('special-draw-effect');
                avatarBox.classList.remove('show'); // ‰æùËµñ CSS transition ËææÂà∞Ê∑°Âá∫ÊïàÊûú
                // ÊöÇÊó∂Á¶ÅÁî®ÊåâÈíÆÔºåÁ≠âÂæÖÊ∑°Âá∫ÂÆåÊàê
                btnMain.disabled = true;
                setTimeout(() => {
                    // Ê∑°Âá∫ÂÆåÊàêÂêéÂºÄÂßãÊªöÂä®ÈÄªËæë
                    if (!nextSelectedUser && !filterAndShuffleDatabase()) {
                        btnMain.disabled = false;
                        return; 
                    }
                    if (!nextSelectedUser) {
                        prepareNextDraw();
                        if(!nextSelectedUser) return;
                    }

                    doStartRollLogic();
                }, 300); // 300ms Ë∂≥Â§üÂÆåÊàê opacity 0.3s ease ÁöÑÊ∑°Âá∫
            } else {
                // Â¶ÇÊûúÊòØÂ≠¶ÁîüÊàñËÄÖÁ¨¨‰∏ÄÊ¨°ÔºåÁõ¥Êé•ÂºÄÂßã
                if (!nextSelectedUser && !filterAndShuffleDatabase()) {
                    btnMain.disabled = false;
                    return; 
                }
                if (!nextSelectedUser) {
                    prepareNextDraw();
                    if(!nextSelectedUser) return;
                }
                doStartRollLogic();
            }
        }
        
        function doStartRollLogic() {
            isRolling = true;
            btnMain.disabled = true; 
            btnMain.innerText = "ÊäΩÂèñ";
            
            // ÁßªÈô§‰∏äÊ¨°ÁöÑ show Á±ªÔºå‰æùËµñ transition Ê∑°Âá∫
            avatarBox.classList.remove('show', 'card-animate'); 
            // ÁßªÈô§‰∏äÊ¨°ÁöÑÁâπÊÆäÁ±ªÂíåÂÖâÊïàÔºåÁ°Æ‰øùÈáçÁΩÆ
            avatarBox.className = 'avatar-container'; 

            btnReveal.classList.remove('reveal-show', 'reveal-hidden');
            nameDisplay.classList.remove('slide-out-up', 'slide-in-up');

            btnReveal.innerText = "ÊòæÁ§∫ÂéüÂêç"; 
            isRealNameShowing = false; 
            nameDisplay.style.backgroundColor = "#f7f7f7";
            nameDisplay.style.borderColor = "#f0f0f0";

            timer = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * filteredDatabase.length);
                nameDisplay.innerText = filteredDatabase[randomIndex].nickname;
            }, 50); 
            
            // **‰øÆÊîπÁÇπ 3: Áº©Áü≠Á¶ÅÁî®Êó∂Èó¥**
            setTimeout(() => {
                if (isRolling) { 
                    btnMain.disabled = false;
                }
            }, 300); 
        }

        function stopRolling() {
            if (!isRolling) return; 
            
            isRolling = false;
            btnMain.disabled = true; 
            btnMain.innerText = "ÂºÄÂßãÊªöÂä®";
            clearInterval(timer);

            selectedUser = nextSelectedUser;
            
            if (!selectedUser) return; 

            nameDisplay.innerText = selectedUser.nickname;

            const isSpecialItem = selectedUser.isSpecial;
            
            // ÈáçÁΩÆÁä∂ÊÄÅ
            avatarBox.className = 'avatar-container'; 
            
            // ËÆæÁΩÆÊñ∞ÁöÑÂÜÖÂÆπÂíåÂä®Áîª
            if (isSpecialItem) {
                avatarBox.classList.add('hide-img', selectedUser.className);
                avatarBox.classList.add('no-hover-effect');
                // Èùû‰∫∫Áâ©ÂÜÖÂÆπ
                nonPersonNameDisplay.innerText = selectedUser.nickname;
                nonPersonNameDisplay.style.display = 'flex'; 
                avatarImg.style.display = 'none';
                
                btnReveal.classList.add('reveal-hidden');
                avatarBox.classList.add('special-draw-effect'); // Ëß¶ÂèëÁâπÊÆäÂä®Áîª
                
            } else {
                // ÊôÆÈÄö‰∫∫Áâ©Â§¥ÂÉè
                avatarImg.src = selectedUser.avatarUrl;
                avatarImg.style.display = 'block'; 
                nonPersonNameDisplay.style.display = 'none';
                avatarBox.classList.remove('hide-img', 'skill-item', 'teacher-item', 'no-hover-effect');

                const randomGlow = glowClasses[Math.floor(Math.random() * glowClasses.length)];
                avatarBox.classList.add('card-animate'); // Ëß¶ÂèëÊôÆÈÄöÂä®Áîª
                avatarBox.classList.add(randomGlow);

                setTimeout(() => {
                    btnReveal.classList.add('reveal-show');
                }, 1000); 
            }
            
            // ÂáÜÂ§á‰∏ã‰∏ÄÊ¨°
            prepareNextDraw();

            const animationDuration = isSpecialItem ? 900 : 1500; // **‰øÆÊîπÁÇπ 3: Áº©Áü≠Âä®ÁîªÁªìÊùüÁ≠âÂæÖÊó∂Èó¥**
            
            setTimeout(() => {
                // Âä®ÁîªÁªìÊùüÊ∏ÖÁêÜÁ±ªÂπ∂ÈáçÊñ∞ÂêØÁî®ÊåâÈíÆ
                if (!isSpecialItem) {
                    avatarBox.classList.remove('card-animate');
                } else {
                    avatarBox.classList.remove('special-draw-effect');
                }
                avatarBox.classList.add('show'); // Á°Æ‰øùÈùûÂä®ÁîªÁä∂ÊÄÅ‰∏ã‰πüÊòæÁ§∫
                btnMain.disabled = false;
            }, animationDuration);
        }
        
        // ÂêçÂ≠óÂàáÊç¢Âä®Áîª
        function toggleRealName() {
            if (!selectedUser || selectedUser.isSpecial) return; 
            
            isRealNameShowing = !isRealNameShowing;

            nameDisplay.classList.add('slide-out-up');

            setTimeout(() => {
                nameDisplay.classList.remove('slide-out-up');
                
                if (isRealNameShowing) {
                    nameDisplay.innerText = selectedUser.realname;
                    btnReveal.innerText = "ÊòæÁ§∫ÁΩëÂêç";
                    nameDisplay.style.backgroundColor = "#ffc107"; // ÈÜíÁõÆÁöÑÈ¢úËâ≤
                    nameDisplay.style.borderColor = "#ff9800";
                } else {
                    nameDisplay.innerText = selectedUser.nickname;
                    btnReveal.innerText = "ÊòæÁ§∫ÂéüÂêç";
                    nameDisplay.style.backgroundColor = "#f7f7f7";
                    nameDisplay.style.borderColor = "#f0f0f0";
                }
                
                nameDisplay.classList.add('slide-in-up');
            }, 200); 
        }

        // --- 4. ‰∫ã‰ª∂ÁªëÂÆö ---

        btnMain.addEventListener('click', () => {
            if (isRolling) {
                stopRolling();
            } else {
                startRolling();
            }
        });

        btnReveal.addEventListener('click', toggleRealName);
        avatarBox.addEventListener('click', toggleRealName);


        // --- 5. ËøáÊª§Âô®ÈÄªËæë ---

        // ÂàáÊç¢ËøáÊª§Âô®ËèúÂçï
        btnFilter.addEventListener('click', () => {
            filterMenu.classList.toggle('open');
            btnFilter.classList.toggle('active');
        });

        // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠ËèúÂçï
        document.addEventListener('click', (event) => {
            if (!filterContainer.contains(event.target) && filterMenu.classList.contains('open')) {
                filterMenu.classList.remove('open');
                btnFilter.classList.remove('active');
            }
        });
        
        // **‰øÆÊîπÁÇπ 1: ÂàáÊç¢ËøáÊª§Âô®Êó∂Ê∏ÖÈô§Â§¥ÂÉèÁä∂ÊÄÅ (‰ΩøÂÖ∂Ê∑°Âá∫)**
        function resetAvatarStateOnFilterChange() {
            avatarBox.classList.remove('show', 'card-animate', 'special-draw-effect', ...glowClasses, 'skill-item', 'teacher-item');
            avatarBox.className = 'avatar-container';
            avatarImg.src = '';
            nonPersonNameDisplay.style.display = 'none';
            nameDisplay.innerText = "Âà´Á¥ßÂº†";
            btnReveal.classList.remove('reveal-show');
            btnReveal.classList.add('reveal-hidden');
            selectedUser = null;
            nextSelectedUser = null; 
            isRealNameShowing = false;
        }

        // Âü∫Êú¨ÈÄâÈ°πÔºàÂàÜÁªÑÔºâ
        baseOptions.forEach(option => {
            option.addEventListener('click', function() {
                const newGroup = this.dataset.value;
                if (currentGroup !== newGroup) {
                    baseOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    currentGroup = newGroup;
                    filterText.innerText = newGroup;
                    resetAvatarStateOnFilterChange(); // **Â∫îÁî®‰øÆÊîπ 1**
                    filterAndShuffleDatabase();
                    prepareNextDraw();
                }
                filterMenu.classList.remove('open');
                btnFilter.classList.remove('active');
            });
        });

        // Â•ñÂä±ÈÄâÈ°πÔºàËÄÅÂ∏à/ÊäÄËÉΩÔºâ
        bonusOptions.forEach(option => {
            option.addEventListener('click', function() {
                const bonusValue = this.dataset.value;
                const index = activeBonuses.indexOf(bonusValue);
                if (index > -1) {
                    activeBonuses.splice(index, 1);
                    this.classList.remove('selected');
                } else {
                    activeBonuses.push(bonusValue);
                    this.classList.add('selected');
                }
                
                // Êõ¥Êñ∞ÊòæÁ§∫ÊñáÊú¨
                let text = currentGroup;
                if (activeBonuses.length > 0) {
                    text += ` + ${activeBonuses.join('/')}`;
                }
                filterText.innerText = text;
                resetAvatarStateOnFilterChange(); // **Â∫îÁî®‰øÆÊîπ 1**
                filterAndShuffleDatabase();
                prepareNextDraw();

                // ‰øùÊåÅËèúÂçïÊâìÂºÄÔºåÁõ¥Âà∞ÁÇπÂáªÂºÄÂßãÊàñÂ§ñÈÉ®
                // filterMenu.classList.remove('open');
                // btnFilter.classList.remove('active');
            });
        });

        // --- 6. ÂàùÂßãÂåñ ---
        document.addEventListener('DOMContentLoaded', () => {
            filterAndShuffleDatabase();
            prepareNextDraw();
            
            // ÂàùÂßãÊòæÁ§∫‰∏Ä‰∏™ÈºìÂä±ËØ≠
            const randomPhrase = startPhrases[Math.floor(Math.random() * startPhrases.length)];
            nameDisplay.innerText = randomPhrase;
        });

    </script>
</body>
</html>
